const BASE_URL=window.location.origin+"/api";MODES=[RECENT_MODE="recent",POPULAR_MODE="popular"],NO_TIMEFRAME="None",TWO_HOURS="2h",FOUR_HOURS="4h",SIX_HOURS="6h",EIGHT_HOURS="8h",TWELVE_HOURS="12h",EIGHTEEN_HOURS="18h",ONE_DAY="1d",TWO_DAYS="2d",THREE_DAYS="3d",FOUR_DAYS="4d",FIVE_DAYS="5d",SIX_DAYS="6d",A_WEEK="1w",TWO_WEEKS="2w",DEFAULT_TIMEFRAME=ONE_HOUR="1h",TIMEFRAMES=[ONE_HOUR,TWO_HOURS,FOUR_HOURS,SIX_HOURS,EIGHT_HOURS,TWELVE_HOURS,EIGHTEEN_HOURS,ONE_DAY,THREE_DAYS,FIVE_DAYS,A_WEEK,TWO_WEEKS,];let currentMode=RECENT_MODE;const MODES_NUMBER=MODES.length;let currentTimeframe=ONE_HOUR,timeframeListElement,timeframePickerElement,modeElement,inputSearchElement,chipsWrapperElement,messagesWrapperElement,helpWrapperElement,timeframeButton,ignoreNeutralButton,combineButton,helpButton,helpShowed=!1,timeFrameShowed=!1,ignoreNeutralOption=!1,combineOption=!1,keywords=[];function submitSearch(){let e=inputSearchElement.value.trim(),t="";if(keywords.length>0){t=keywords[0];for(let n=1;n<keywords.length;n++){let a=keywords[n];t+=","+a}}if(e.length>0&&(combineOption?t+=" "+e:keywords.length>0?t+=","+e:t+=e),(t=t.trim()).length<=0)return showError("Please insert a valid input"),!1;cleanMessages(),showInfo("Searching");let l=BASE_URL+"/analyze-keywords?keywords="+encodeURIComponent(t)+"&ignore_neutral="+ignoreNeutralOption+"&combine="+combineOption;currentTimeframe!==NO_TIMEFRAME&&(l+="&timeframe="+currentTimeframe),fetch(l).then(e=>e.ok?e.json():(429===e.status?showError("Request limit reached, try again later."):showError("No data available. Try different topics, time interval or sentiment mode."),!1)).then(e=>showResult(e.result)).catch()}function showInfo(e){showMessage(e,"info-message")}function showError(e){showMessage(e,"error-message")}function showResult(e){let t="";for(let n of Object.keys(e)){let a=e[n].charAt(0).toUpperCase()+e[n].substr(1).toLowerCase();t+=n+": "+a+" "}showInfo(t),highlight()}function showMessage(e,t){cleanMessages(),messagesWrapperElement.style.display="flex";let n=document.createElement("div");n.appendChild(document.createTextNode(e)),n.classList.add("message"),n.classList.add(t),messagesWrapperElement.appendChild(n)}function cleanMessages(){messagesWrapperElement.innerHTML="",messagesWrapperElement.style.display="none"}function highlight(){let e=messagesWrapperElement.innerText.split(" ");messagesWrapperElement.innerHTML="";let t=document.createElement("p");e.forEach(e=>{let n=document.createElement("span");switch(e){case"Negative":n.classList.add("negative"),n.textContent+=e;break;case"Neutral":n.classList.add("neutral"),n.textContent+=e;break;case"Positive":n.classList.add("positive"),n.textContent+=e;break;case"No_data_available":n.classList.add("no-data-available"),e="No data available",n.textContent+=e;break;default:e+=" "}if(n.textContent.length>0){t.appendChild(n);let a=document.createElement("br");t.appendChild(a)}else{let l=document.createTextNode(e);t.appendChild(l)}}),messagesWrapperElement.classList.add("message");let n=t.querySelectorAll("br");t.removeChild(n[n.length-1]),messagesWrapperElement.appendChild(t)}function changeMode(){let e=MODES.indexOf(currentMode)+1;setMode(currentMode=e>=MODES_NUMBER?MODES[0]:MODES[e])}function setMode(e){currentMode=e,setModeText(e),checkModeOptions(),animate()}function showHelp(e=null){(helpShowed=e||!helpShowed)?(helpWrapperElement.style.display="flex",helpButton.classList.add("active-btn")):(helpWrapperElement.style.display="none",helpButton.classList.remove("active-btn"))}function setIgnoreNeutralOption(e=null){e||(e=!ignoreNeutralOption),(ignoreNeutralOption=e)?ignoreNeutralButton.classList.add("active-btn"):ignoreNeutralButton.classList.remove("active-btn")}function setCombineOption(e=null){e||(e=!combineOption),(combineOption=e)?combineButton.classList.add("active-btn"):combineButton.classList.remove("active-btn")}function setModeText(e){modeElement.textContent=e}function animate(){modeElement.innerHTML=modeElement.textContent.replace(/\S/g,"<span class='letter'>$&</span>"),anime.timeline({loop:!0}).add({targets:"#search-mode .letter",scale:[.3,1],opacity:[0,1],translateZ:0,easing:"easeOutExpo",duration:4e3,delay:(e,t)=>80*(t+1)})}function setTimeframe(e){currentTimeframe=e,showTimeframes(!1)}function showTimeframes(e=null){if(timeFrameShowed||!1===e)timeframeListElement.style.display="none",timeframePickerElement.style.display="none";else for(let t of(timeframeListElement.style.display="flex",timeframePickerElement.style.display="block",timeframeListElement.innerHTML="",TIMEFRAMES)){let n=document.createElement("li");n.classList.add("timeframe-item"),t===currentTimeframe&&n.classList.add("active-timeframe"),n.appendChild(document.createTextNode(t)),n.onclick=()=>setTimeframe(t),timeframeListElement.appendChild(n)}timeFrameShowed=!timeFrameShowed}function checkModeOptions(){inputSearchElement.value.length>0||keywords.length>0?currentMode===RECENT_MODE?(setRecentInputMode(),timeframeButton.style.display="block",setTimeframe(ONE_HOUR)):(setPopularInputMode(),timeframeButton.style.display="none",setTimeframe(NO_TIMEFRAME)):(setUnsearchableInputMode(),timeframeButton.style.display="none",setTimeframe(NO_TIMEFRAME))}function checkInput(){let e=inputSearchElement.value;if(""===e.trim()||" "===e[e.length-1])return" "===e[e.length-1]&&(inputSearchElement.value=e.trim()+" "),!1;checkModeOptions(),checkChips()}function setUnsearchableInputMode(){inputSearchElement.style.width="90rem"}function setPopularInputMode(){inputSearchElement.style.width="84rem"}function setRecentInputMode(){inputSearchElement.style.width="78rem"}function checkChips(){let e=inputSearchElement.value;e=e.trim();let t=e.split(",");for(let n of(t[t.length-1].length<=0&&t.pop(),e&&e[e.length-1].length>0&&","!==e[e.length-1]?(inputSearchElement.value=t[t.length-1],t.pop()):inputSearchElement.value="",t))n.length>0&&createChip(n.trim())}function removeChip(e){let t=keywords.indexOf(e);chipsWrapperElement.removeChild(chipsWrapperElement.children[t]),keywords.splice(t,1),checkModeOptions()}function createChip(e){if(keywords.push(e),chipsWrapperElement.innerHTML="",keywords.length>0)for(let t of(chipsWrapperElement.style.display="flex",keywords)){let n=document.createElement("div");n.appendChild(document.createTextNode(t)),n.classList.add("chip"),n.onclick=()=>removeChip(t),chipsWrapperElement.appendChild(n)}}function init(){modeElement=document.getElementById("search-mode"),inputSearchElement=document.getElementById("search"),timeframeListElement=document.getElementById("timeframes-list"),timeframePickerElement=document.getElementById("timeframes-picker"),timeframeButton=document.getElementById("timeframe-btn"),ignoreNeutralButton=document.getElementById("ignore-neutral-btn"),combineButton=document.getElementById("combine-btn"),helpButton=document.getElementById("help-btn"),chipsWrapperElement=document.getElementById("chips-wrapper"),messagesWrapperElement=document.getElementById("messages-wrapper"),helpWrapperElement=document.getElementById("help-wrapper"),setMode(currentMode),setIgnoreNeutralOption(!0)}
